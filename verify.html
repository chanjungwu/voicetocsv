<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>開通軟體 - 語音控制CSV修改系統</title>
    <link rel="stylesheet" href="/assets/css/style.css">
</head>
<body data-theme="dark">
    <div class="container">
        <header class="header">
            <h1>🚀 軟體啟用驗證</h1>
            <p>請輸入您的匯款資訊以完成驗證，並取得啟用碼。</p>
        </header>

        <main>
            <div class="card">
                <form id="verify-form">
                    <div class="form-group">
                        <label for="amount">匯款金額 (NT$)</label>
                        <input type="number" id="amount" name="amount" placeholder="例如：250" required>
                    </div>
                    <div class="form-group-inline">
                        <div class="form-group">
                            <label for="date">匯款日期</label>
                            <input type="date" id="date" name="date" required>
                        </div>
                        <div class="form-group">
                            <label for="time">匯款時間 (24小時制)</label>
                            <input type="time" id="time" name="time" required step="60">
                        </div>
                    </div>
                     <div class="form-group">
                        <label for="account">您的匯款帳號後五碼</label>
                        <input type="text" id="account" name="account" pattern="\d{5}" title="請輸入5位數字" placeholder="用於備核，請務必填寫" required>
                    </div>
                    <div class="form-group">
                        <label for="email">您的 Email 地址</label>
                        <input type="email" id="email" name="email" placeholder="用於接收啟用碼備份" required>
                    </div>

                    <button type="submit" id="submit-button">驗證並取得啟用碼</button>
                </form>
            </div>

            <div id="result" class="result-card" style="display: none;"></div>
        </main>
    </div>

    <script>
        const form = document.getElementById('verify-form');
        const submitButton = document.getElementById('submit-button');
        const resultDiv = document.getElementById('result');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            submitButton.disabled = true;
            submitButton.textContent = '驗證中...';
            resultDiv.style.display = 'none';
            resultDiv.className = 'result-card';

            const formData = {
                amount: document.getElementById('amount').value,
                date: document.getElementById('date').value,
                time: document.getElementById('time').value,
                account: document.getElementById('account').value,
                email: document.getElementById('email').value,
            };

            try {
                const response = await fetch('/api/verify', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData),
                });

                const data = await response.json();

                if (response.ok) {
                    resultDiv.className = 'result-card success';
                    resultDiv.innerHTML = `
                        <h3>✅ 驗證成功！</h3>
                        <p>這是您的專屬啟用碼，請妥善保管：</p>
                        <div class="activation-code">${data.activationCode}</div>
                        <p class="small-text">我們也將啟用碼寄送至您的Email信箱作為備份。</p>
                    `;
                } else {
                    throw new Error(data.error || '發生未知錯誤');
                }
            } catch (error) {
                resultDiv.className = 'result-card error';
                resultDiv.innerHTML = `
                    <h3>❌ 驗證失敗</h3>
                    <p>${error.message}</p>
                    <p class="small-text">請檢查您輸入的資料是否與匯款紀錄完全相符。如果問題持續，請聯繫客服。</p>
                `;
            } finally {
                resultDiv.style.display = 'block';
                submitButton.disabled = false;
                submitButton.textContent = '驗證並取得啟用碼';
                resultDiv.scrollIntoView({ behavior: 'smooth' });
            }
        });
    </script>
</body>
</html>